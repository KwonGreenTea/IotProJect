<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.iot.web.mapper.ProductMapper">

    <resultMap type="com.iot.web.domain.ProductInfoDTO" id="deviceResultMap">
        <id property="productId" column="PRODUCT_ID" />
        <result property="sellerId" column="SELLER_ID" />
        <result property="productName" column="PRODUCT_NAME" />
        <result property="price" column="PRICE" />
        <result property="minTemp" column="MIN_TEMPERATURE" />
        <result property="maxTemp" column="MAX_TEMPERATURE" />
        <result property="minHum" column="MIN_HUMIDITY" />
        <result property="maxHum" column="MAX_HUMIDITY" />
    </resultMap>

    
    <select id="retreiveProductDataYn" resultType="java.lang.String">
	    <![CDATA[
		    SELECT
		        CASE
		            WHEN (
		                #{dataDTO.maxTemperature} > A.MAX_TEMPERATURE
		                OR #{dataDTO.maxHumidity} > A.MAX_HUMIDITY
		                OR #{dataDTO.minTemperature} < A.MIN_TEMPERATURE
		                OR #{dataDTO.minHumidity} < A.MIN_HUMIDITY
		            )
		            THEN 'Y'
		            ELSE 'N'
		        END AS resultCd
		    FROM PRODUCT_INFO A, ORDER_INFO B 
            WHERE A.PRODUCT_ID = B.PRODUCT_ID
		      AND B.USER_ID = #{userId}
	    ]]>
	</select>

</mapper>
