<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>주문 모니터링</title>
  <link rel="stylesheet" href="/css/base.css"/>
</head>
<body class="app-body">
  <div class="app-shell">

    <!-- 상단 헤더 + 뒤로가기 -->
    <header class="page-header page-header--with-back">
	  <div>
		<h1 class="page-title">주문 모니터링</h1>
		<p class="page-subtitle">
		  선택한 주문의 배송 상태와 온·습도를 한 화면에서 확인하세요.
		</p>
	  </div>
      <a class="btn btn-ghost btn-back" href="/admin/orders">← 구매자 리스트</a>
     
    </header>

    <!-- 주문 요약 (JS에서 innerHTML 채우기) -->
    <section id="summary" class="card card--summary"></section>

    <!-- 온습도 카드 -->
    <section class="card">
      <div class="card-header card-header--between">
        <div>
          <h2 class="card-title">온·습도 실시간</h2>
          <p class="card-subtitle">
            센서에서 전달되는 값을 기반으로 제품 보관 상태를 모니터링합니다.
          </p>
        </div>
        <div class="card-actions">
          <button id="ship" class="btn btn-soft">배송 시작</button>
          <button id="complete" class="btn btn-primary">배송 완료</button>
        </div>
      </div>

      <div id="sensor" class="sensor-panel">
        <div class="sensor-main">
          <div class="chip chip--temp">
            <span class="chip-label">온도</span>
            <span class="chip-value">
              🌡️ <b id="temp">--</b><span class="chip-unit">°C</span>
            </span>
          </div>

          <div class="chip chip--humid">
            <span class="chip-label">습도</span>
            <span class="chip-value">
              💧 <b id="humid">--</b><span class="chip-unit">%</span>
            </span>
          </div>
        </div>

        <div class="sensor-meta">
          <div class="sensor-timestamp">
            <span class="sensor-label">마지막 업데이트</span>
            <span class="sensor-value" id="ts">--</span>
          </div>
        </div>
      </div>

      <div class="sensor-tip" id="tip"></div>
    </section>

    <!-- 주문 상품 테이블 -->
    <section class="card">
      <div class="card-header">
        <div>
          <h2 class="card-title">주문 상품</h2>
          <p class="card-subtitle">
            해당 주문에 포함된 상품 목록과 수량, 가격을 확인합니다.
          </p>
        </div>
      </div>

      <div class="table-wrapper">
        <table class="table" id="items">
          <thead>
          <tr>
            <th>상품</th>
            <th>수량</th>
            <th>가격</th>
          </tr>
          </thead>
          <tbody>
          <!-- JS에서 렌더링 -->
          </tbody>
        </table>
      </div>
    </section>

  </div>

  <script type="module" src="/js/pages/adminMonitor.js"></script>
  
  <script th:inline="javascript">
  /*<![CDATA[*/
      const deviceId = /*[[${deviceId}]]*/ 'UNKNOWN';
      console.log("Connecting SSE for deviceId =", deviceId);

      const eventSource = new EventSource(`/data/stream/${deviceId}`);
      eventSource.addEventListener("newData", function(event) {
         const d = JSON.parse(event.data);
         console.log("Received SSE data =", d);

         document.getElementById("temp").innerText = d.temperature.toFixed(1);;
         document.getElementById("humid").innerText = d.humidity;
         document.getElementById("ts").innerText = d.measuredAt;
      });
     
  /*]]>*/
  </script>
		
</body>
</html>
